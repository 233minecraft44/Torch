From ca59eae227d391d75d74cbf34ee892487c71a1c1 Mon Sep 17 00:00:00 2001
From: SotrForgotten <i@omc.hk>
Date: Fri, 1 Jul 2016 14:31:35 +0800
Subject: [PATCH] Fix the IndexOutOfBoundsException


diff --git a/src/main/java/net/techcable/tacospigot/ArrayMap.java b/src/main/java/net/techcable/tacospigot/ArrayMap.java
index 9a0684a..c2d9c8b 100644
--- a/src/main/java/net/techcable/tacospigot/ArrayMap.java
+++ b/src/main/java/net/techcable/tacospigot/ArrayMap.java
@@ -115,11 +115,11 @@ public final class ArrayMap<V> extends AbstractInt2ObjectMap<V> {
            assert Thread.holdsLock(this);
         AtomicReferenceArray<V> values = this.values;
         AtomicReferenceArray<V> copy = new AtomicReferenceArray<>(key + 1);
-        for (int i = 0; i < values.length(); i++) {
+        for (int i = 0; i < key; i++) {
             copy.set(i, values.get(i));
         }
         this.values = copy;
-        values.set(key, value);
+        copy.set(key, value);
         SIZE_UPDATER.incrementAndGet(this);
        }
 
-- 
2.8.2.windows.1

