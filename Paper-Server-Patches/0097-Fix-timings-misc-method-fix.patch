From 13fc22b9720d0b8e3750427c6eac1e6894fd4040 Mon Sep 17 00:00:00 2001
From: SotrForgotten <i@omc.hk>
Date: Sat, 2 Jul 2016 19:53:16 +0800
Subject: [PATCH] Fix timings, misc method fix


diff --git a/src/main/java/net/minecraft/server/ChunkProviderServer.java b/src/main/java/net/minecraft/server/ChunkProviderServer.java
index 0aca107..99b45b7 100644
--- a/src/main/java/net/minecraft/server/ChunkProviderServer.java
+++ b/src/main/java/net/minecraft/server/ChunkProviderServer.java
@@ -184,7 +184,7 @@ public class ChunkProviderServer implements IChunkProvider {
         // CraftBukkit end
 
         if (chunk == null) {
-            world.timings.syncChunkLoadTimer.startTiming(); // Spigot
+            // world.timings.syncChunkLoadTimer.startTiming(); // Spigot
             long k = ChunkCoordIntPair.a(i, j);
 
             try {
@@ -203,7 +203,7 @@ public class ChunkProviderServer implements IChunkProvider {
             chunk.addEntities();
 
             chunk.loadNearby(this, this.chunkGenerator, true); // CraftBukkit
-            world.timings.syncChunkLoadTimer.stopTiming(); // Spigot
+            // world.timings.syncChunkLoadTimer.stopTiming(); // Spigot
         }
 
         return chunk;
diff --git a/src/main/java/net/minecraft/server/DataPaletteBlock.java b/src/main/java/net/minecraft/server/DataPaletteBlock.java
index 4f4e7af..cd55357 100644
--- a/src/main/java/net/minecraft/server/DataPaletteBlock.java
+++ b/src/main/java/net/minecraft/server/DataPaletteBlock.java
@@ -7,7 +7,6 @@ public class DataPaletteBlock implements DataPaletteExpandable {
     private static final DataPalette d = new DataPaletteGlobal();
     protected static final IBlockData a = Blocks.AIR.getBlockData();
     protected DataBits b;
-	private final short[] data = new short[4096]; // Paper
     protected DataPalette c;
     private int e = 0;
 
@@ -59,14 +58,9 @@ public class DataPaletteBlock implements DataPaletteExpandable {
     }
 
     protected void setBlockIndex(int i, IBlockData iblockdata) {
-		// Paper start - performance sanity
-        /*
          int j = this.c.a(iblockdata);
  
          this.b.a(i, j);
-        */
-        data[i] = (short) Block.REGISTRY_ID.getId(iblockdata);
-        // Paper end
     }
 
     public IBlockData a(int i, int j, int k) {
@@ -74,7 +68,7 @@ public class DataPaletteBlock implements DataPaletteExpandable {
     }
 
     protected IBlockData a(int i) {
-        IBlockData iblockdata = Block.REGISTRY_ID.fromId(data[i]); // Paper - performance sanity
+        IBlockData iblockdata = this.c.a(this.b.a(i));
 
         return iblockdata == null ? DataPaletteBlock.a : iblockdata;
     }
-- 
2.8.2.windows.1

