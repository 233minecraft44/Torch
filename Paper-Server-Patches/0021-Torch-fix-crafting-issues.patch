From 6113cb8a0f6b77b19e1c6af2ba8b039f8f79925e Mon Sep 17 00:00:00 2001
From: SotrForgotten <i@omc.hk>
Date: Sun, 26 Jun 2016 01:15:42 +0800
Subject: [PATCH] Torch fix crafting issues


diff --git a/src/main/java/net/minecraft/server/Container.java b/src/main/java/net/minecraft/server/Container.java
index 2757f58..ee54bc0 100644
--- a/src/main/java/net/minecraft/server/Container.java
+++ b/src/main/java/net/minecraft/server/Container.java
@@ -22,14 +22,7 @@ import org.bukkit.inventory.InventoryView;
 public abstract class Container {
 
     public List<ItemStack> b = Lists.newArrayList();
-    // TacoSpigot start - A lot of code expects get() to return null rather than throwing ArrayIndexOutOfBoundsException
-    public List<Slot> c = new ArrayList<Slot>() {
-        @Override
-        public Slot get(int index) {
-            return index < size() ? super.get(index) : null;
-        }
-    };
-    // TacoSpigot end
+    public List<Slot> c = Lists.newArrayList(); // Torch - fix crafting
     public int windowId;
     private int dragType = -1;
     private int g;
diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java
index 623ebf8..8935fc3 100644
--- a/src/main/java/net/minecraft/server/PlayerConnection.java
+++ b/src/main/java/net/minecraft/server/PlayerConnection.java
@@ -1682,7 +1682,7 @@ public class PlayerConnection implements PacketListenerPlayIn, ITickable {
     public void a(PacketPlayInWindowClick packetplayinwindowclick) {
         PlayerConnectionUtils.ensureMainThread(packetplayinwindowclick, this, this.player.x());
         if (this.player.dead) return; // CraftBukkit
-        if (packetplayinwindowclick.b() < 0 || this.player.activeContainer.getSlot(packetplayinwindowclick.b()) == null) return; // TacoSpigot - ignore packets with invalid slot
+        // if (packetplayinwindowclick.b() < 0 || this.player.activeContainer.getSlot(packetplayinwindowclick.b()) == null) return; // TacoSpigot - ignore packets with invalid slot // Torch - fix crafting
         this.player.resetIdleTimer();
         if (this.player.activeContainer.windowId == packetplayinwindowclick.a() && this.player.activeContainer.c(this.player)) {
             boolean cancelled = this.player.isSpectator(); // CraftBukkit - see below if
diff --git a/src/main/java/org/bukkit/craftbukkit/inventory/CraftInventoryView.java b/src/main/java/org/bukkit/craftbukkit/inventory/CraftInventoryView.java
index 0ab254e..4cf5b10 100644
--- a/src/main/java/org/bukkit/craftbukkit/inventory/CraftInventoryView.java
+++ b/src/main/java/org/bukkit/craftbukkit/inventory/CraftInventoryView.java
@@ -11,7 +11,7 @@ import org.bukkit.inventory.ItemStack;
 
 import net.minecraft.server.Container;
 // TacoSpigot start
-import com.google.common.base.Preconditions;
+//import com.google.common.base.Preconditions; // Torch - fix crafting
 // TacoSpigot end
 
 public class CraftInventoryView extends InventoryView {
@@ -65,7 +65,7 @@ public class CraftInventoryView extends InventoryView {
         if (slot == -999) {
             return null;
         }
-        Preconditions.checkElementIndex(slot, container.c.size(), "slot"); // TacoSpigot - bounds check
+        // Preconditions.checkElementIndex(slot, container.c.size(), "slot"); // TacoSpigot - bounds check // Torch - fix crafting
         return CraftItemStack.asCraftMirror(container.getSlot(slot).getItem());
     }
 
-- 
2.8.2.windows.1

